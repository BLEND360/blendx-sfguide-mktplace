spec:
  containers:
    - name: eap-frontend
      image: /BLENDX_APP_DB/BLENDX_SCHEMA/images/eap_frontend:{{IMAGE_TAG}}
      env:
        VUE_APP_API_URL: /api
    - name: eap-backend
      image: /BLENDX_APP_DB/BLENDX_SCHEMA/images/eap_backend:{{IMAGE_TAG}}
      env:
        ENVIRONMENT: PRODUCTION
        SNOWFLAKE_AUTHMETHOD: oauth
        SNOWFLAKE_WAREHOUSE: BLENDX_APP_WH
        # SNOWFLAKE_DATABASE is intentionally not set - will use session context from OAuth
        # Tables are accessed as schema.table_name using the app's database context
        SNOWFLAKE_SCHEMA: app_data
        CREW_EXECUTION_SCHEMA: app_data
        WORKFLOWS_SCHEMA: app_data
        CREWAI_DISABLE_TELEMETRY: true
        OTEL_SDK_DISABLED: true
        # Gunicorn configuration
        GUNICORN_WORKERS: "4"
        GUNICORN_THREADS: "4"
        GUNICORN_TIMEOUT: "0"
        GUNICORN_KEEPALIVE: "650"
      secrets:
        - snowflakeSecret:
            objectReference: serper_api_key
          directoryPath: /secrets/serper

    - name: eap-router
      image: /BLENDX_APP_DB/BLENDX_SCHEMA/images/eap_router:{{IMAGE_TAG}}
      env:
        FE_SERVER: 127.0.0.1:8080
        BE_SERVER: 127.0.0.1:8081

  endpoints:
    - name: app
      port: 8000
      public: true
