spec:
  containers:
    - name: eap-frontend
      image: /{{SNOWFLAKE_DATABASE}}/{{SNOWFLAKE_SCHEMA}}/{{SNOWFLAKE_IMG_REPO}}/eap_frontend
      env:
        VUE_APP_API_URL: /api
    - name: eap-backend
      image: /{{SNOWFLAKE_DATABASE}}/{{SNOWFLAKE_SCHEMA}}/{{SNOWFLAKE_IMG_REPO}}/eap_backend
      env:
        ENVIRONMENT: PRODUCTION
        SNOWFLAKE_AUTHMETHOD: oauth
        SNOWFLAKE_WAREHOUSE: BLENDX_APP_WH
        # SNOWFLAKE_DATABASE is intentionally not set - will use session context from OAuth
        # Tables are accessed as schema.table_name using the app's database context
        SNOWFLAKE_SCHEMA: app_data
        CREW_EXECUTION_SCHEMA: app_data
        WORKFLOWS_SCHEMA: app_data
        CREWAI_DISABLE_TELEMETRY: true
        OTEL_SDK_DISABLED: true
      secrets:
        - snowflakeSecret:
            objectReference: serper_api_key
          directoryPath: /secrets/serper

    - name: eap-router
      image: /{{SNOWFLAKE_DATABASE}}/{{SNOWFLAKE_SCHEMA}}/{{SNOWFLAKE_IMG_REPO}}/eap_router
      env:
        FE_SERVER: 127.0.0.1:8080
        BE_SERVER: 127.0.0.1:8081

  endpoints:
    - name: app
      port: 8000
      public: true
